<meta charset="UTF-8">
<title>Note</title>
<head>
</head>
<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=0" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/aes-js/3.1.2/index.min.js"></script>
<link href="https://erichsia7.github.io/note/note_icon.png" sizes="512x512" rel="apple-touch-icon-precomposed" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<!--<meta name="apple-mobile-web-app-status-bar-style" content="black" />-->
<meta name="theme-color" content="#fff">
<style id="color_set"></style>
<style>
  body {
  background:var(--color-light);
    color:var(--color-ftf)
  }
  .load {
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%)
  }
  @media (prefers-color-scheme: dark) {
    body {
    background:var(--color-dark);
      color:#fff
    }
  }
</style>
<body>
  <div class="load">decoding</div>
  </body>
<script>
  var getUrlString = location.href;
var url = new URL(getUrlString);
var url_d = url.searchParams.get('d');
var url_pw = url.searchParams.get('pw');

  function genid(mode) {
if(mode === "random"){
var genidchars = "0123456789abcdefghijklmnopqrstuvwxyz";
            var genid = "";
            for (var i = 0; i < 16; i++) {
                var genrandomNumber = Math.floor(Math.random() * genidchars.length);
                genid += genidchars.substring(genrandomNumber, genrandomNumber + 1);
            }
  return genid ;
}
          
 if(mode === "time"){
   var gtoday=new Date();
   var genid2 = (gtoday.getMonth()+1) + '_' + gtoday.getDate() + '_' + gtoday.getHours() + '_' + gtoday.getMinutes() + '_' + gtoday.getSeconds() + '-' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8)) + '' + (1+Math.floor(Math.random() * 8));
   
   return genid2
 }
  
  if(mode === "number"){
   
   var genid3 = '' ;
for (var i = 0; i < 16; i++) {
  genid3 += '' + (0+Math.floor(Math.random() * 9))
}
   return genid3
 }
  
  if(mode === "uuid"){
var genidchars4 = "abcdef012345678";
    var geniduu = [8,4,4,4,12];
            var genid4 = "";
            var genid5 = "";
    for (var ia = 0; ia < geniduu.length; ia++) {
      var genid4 = "";
            for (var i = 0; i < geniduu[ia]; i++) {
                var genrandomNumber4 = Math.floor(Math.random() * genidchars4.length);
                genid4 += genidchars4.substring(genrandomNumber4, genrandomNumber4 + 1);
            }
genid5 += '-' + genid4 ;
    }
    return genid5.substring(1,genid5.length)
  }
  }
  
function encu(textu) {
 var ivqu = parseInt(
                    Math.floor(Math.random() * 8 + 1) +
                        "" +
                        Math.floor(Math.random() * 8 + 1) +
                        "" +
                        Math.floor(Math.random() * 8 + 1) +
                        "" +
                        Math.floor(Math.random() * 8 + 1) +
                        "" +
                        Math.floor(Math.random() * 8 + 1) +
                        "" +
                        Math.floor(Math.random() * 8 + 1)
                );
                
                var keyu = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31];
                
                var textBytesu = aesjs.utils.utf8.toBytes(textu);

                var aesCtru = new aesjs.ModeOfOperation.ctr(keyu, new aesjs.Counter(ivqu));
                var encryptedBytesu = aesCtru.encrypt(textBytesu);

                var encryptedHexu = aesjs.utils.hex.fromBytes(encryptedBytesu);
                console.log(encryptedHexu);
                return [encryptedHexu,ivqu]
                
            }

function decu(juy,oik) {
                var keye = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31];
                var gbu = juy;
                var kiu = oik;
                var encryptedBytese = aesjs.utils.hex.toBytes(gbu);

                // The counter mode of operation maintains internal state, so to
                // decrypt a new instance must be instantiated.
                var aesCtre = new aesjs.ModeOfOperation.ctr(keye, new aesjs.Counter(parseInt(kiu)));
                var decryptedBytese = aesCtre.decrypt(encryptedBytese);

                // Convert our bytes back into text
                var decryptedTexte = aesjs.utils.utf8.fromBytes(decryptedBytese);
                console.log(decryptedTexte);
                return decryptedTexte;
                
            }
    
  function getcolorset(main_color_h) {
  var liga = hsv2rgb(main_color_h,18,100)
  var light_color = rgbToHex(Math.round(liga[0]),Math.round(liga[1]),Math.round(liga[2])) ;
  var darka = hsv2rgb(main_color_h,55,16)
  var dark_color = rgbToHex(Math.round(darka[0]),Math.round(darka[1]),Math.round(darka[2])) ;
  
  var grea = hsv2rgb(main_color_h,30,50)
  var grey_color = rgbToHex(Math.round(grea[0]),Math.round(grea[1]),Math.round(grea[2])) ;
  
  var ftf = hsv2rgb(main_color_h,80,20)
  var ftf_color = rgbToHex(Math.round(ftf[0]),Math.round(ftf[1]),Math.round(ftf[2])) ;
  
  return {'light':light_color,'dark':dark_color,'grey':grey_color,'ftf':ftf_color,'arr':[light_color,dark_color,grey_color,ftf_color]}
}
  var color_h = parseInt(url_d.split(',')[2])
  $('#color_set').html(':root {--color-light:' + getcolorset(color_h).light + ';--color-dark:' + getcolorset(color_h).dark + ';--color-grey:' + getcolorset(color_h).grey + ';--color-ftf:' + getcolorset(color_h).ftf + '}')
  
  var noteid ;
    
function saveftyyy() {
  var idchars = "0123456789abcdefghijklmnopqrstuvwxyz";
            noteid = "";
            for (var i = 0; i < 16; i++) {
                var idrandomNumber = Math.floor(Math.random() * idchars.length);
                noteid += idchars.substring(idrandomNumber, idrandomNumber + 1);
            }
  //history.pushState(null, null,'https://erichsia7.github.io/note/d/?n=1&id=' + noteid);
  var enftpw = url_pw.split('_') ;
  var titpw = parseInt(enftpw[0],32)
  var txtpw = parseInt(enftpw[1],32)
  var encdtoi = url_d.split(',')[0] + ':' + titpw + ',' + url_d.split(',')[1] + ':' + txtpw + ',' + url_d.split(',')[2]
  localStorage.setItem('note_id_list', localStorage.getItem('note_id_list') + ',' + noteid);
  localStorage.setItem('note_id_' + noteid, encdtoi);
  setTimeout(function() {
  location.href = 'https://erichsia7.github.io/note/d/?n=1&id=' + noteid + '&r=' + genid('random');
  },800);
  }
  saveftyyy()
</script>

